<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">lib/models/Config.js | Insac Framework</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Framework de creaci&#xF3;n de servicios web"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Insac Framework"><meta property="twitter:description" content="Framework de creaci&#xF3;n de servicios web"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/waquispe/insac"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Insac.js~Insac.html">Insac</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#datatypes">datatypes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/datatypes/DataType.js~DataType.html">DataType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/datatypes/INTEGER.js~INTEGER.html">INTEGER</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/datatypes/STRING.js~STRING.html">STRING</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#models">models</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Config.js~Config.html">Config</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Database.js~Database.html">Database</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Field.js~Field.html">Field</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Middleware.js~Middleware.html">Middleware</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Model.js~Model.html">Model</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Reference.js~Reference.html">Reference</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Response.js~Response.html">Response</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/ResponseError.js~ResponseError.html">ResponseError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Seeder.js~Seeder.html">Seeder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Server.js~Server.html">Server</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#routes">routes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/Route.js~Route.html">Route</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/RouteDelete.js~RouteDelete.html">RouteDelete</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/RouteGet.js~RouteGet.html">RouteGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/RoutePost.js~RoutePost.html">RoutePost</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/RoutePut.js~RoutePut.html">RoutePut</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#tools">tools</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/tools/DataTypes.js~DataTypes.html">DataTypes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/tools/Util.js~Util.html">Util</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/tools/Validators.js~Validators.html">Validators</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#validators">validators</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/validators/INTEGER_VALIDATOR.js~INTEGER_VALIDATOR.html">INTEGER_VALIDATOR</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/validators/STRING_VALIDATOR.js~STRING_VALIDATOR.html">STRING_VALIDATOR</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/validators/Validator.js~Validator.html">Validator</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/models/Config.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;
/** @ignore */ const fs = require(&apos;fs&apos;)
/** @ignore */ const path = require(&apos;path&apos;)

/**
* Administra todas las configuraciones del proyecto y de la aplicaci&#xF3;n.
*/
class Config {

  /**
  * Crea una instancia del objeto Config.
  * @param {Object} [config={}] - Objeto que contiene todas las variables de configuraci&#xF3;n.
  * @param {String} [config.env=&apos;development&apos;] - Tipo de ambiente sobre el que se ejecutar&#xE1; la aplicaci&#xF3;n (development, test &#xF3; production).
  * @param {String} [config.projectPath] - Ruta absoluta del directorio raiz del proyecto.
  * @param {String} [config.path] - Rutas absolutas de los directorios del proyecto.
  * @param {String} [config.path.public] - Carpeta p&#xFA;blica.
  * @param {String} [config.path.config] - Carpeta donde se encuentran los archivos de configuraci&#xF3;n.
  * @param {String} [config.path.global] - Carpeta donde se encuentran los archivos que contienen las variables globales de la aplicaci&#xF3;n.
  * @param {String} [config.path.middlewares] - Carpeta donde se encuentran los middlewares.
  * @param {String} [config.path.models] - Carpeta donde se encuentran los modelos.
  * @param {String} [config.path.routes] - Carpeta donde se administran todas las rutas.
  * @param {String} [config.path.seeders] - Carpeta donde se encuentran los seeders.
  * @param {Object} [config.server] - Objeto que contiene los campos de configuraci&#xF3;n del servidor. Todas las opciones posibles se describen en {@link Server#constructor}
  * @param {Object} [config.database] - Configuraci&#xF3;n del servidor de base de datos. Todas las opciones posibles se describen en {@link Database#constructor}
  * @param {Object} [config.auth] - Objeto que contiene los campos de configuraci&#xF3;n para el sistema de autenticaci&#xF3;n.
  * @param {Object} [config.auth.token] - Objeto que contiene informaci&#xF3;n de configuraci&#xF3;n del token para el sistema de autenticaci&#xF3;n.
  * @param {String} [config.auth.token.key=&apos;SECRET&apos;] - Clave secreta que se utiliza para crear el token.
  * @param {Number} [config.auth.token.expires=86400] - Tiempo en segundos que indica la validez del token desde su creaci&#xF3;n.
  */
  constructor(config = {}) {
    /**
    * Variable de entorno que almacena el tipo de ejecuci&#xF3;n.
    * @type {String} [env=&apos;development&apos;]
    */
    this.env = process.env.NODE_ENV = config.env || &apos;development&apos;

    /**
    * Ruta del directorio raiz del proyecto.
    * @type {String}
    */
    this.projectPath = config.projectPath || Config.defaultProjectPath()

    /**
    * Rutas de los directorios del proyecto
    * @type {Object}
    */
    this.path = Config.defaultPath(this.projectPath)

    /**
    * Configuraci&#xF3;n por defecto del servidor
    * @type {Object}
    */
    this.server = Config.defaultServer()

    /**
    * Configuraci&#xF3;n por defecto de la base de datos
    * @type {Object}
    */
    this.database = Config.defaultDatabase()

    /**
    * Configuraci&#xF3;n por defecto del sistema de autenticaci&#xF3;n mediante tokens
    * @type {Object}
    */
    this.auth = Config.defaultAuth()

    // Carga todas las configuraciones personalizadas
    this._loadProjectConfig(config, this.projectPath)
    this._loadAppConfig(config, this.path.config)
    this._loadAppGlobal()
  }

  /**
  * Se actualiza la configuraci&#xF3;n solamente para el modo de ejecuci&#xF3;n establecido al momento de crear el objeto. Es posible agregar datos adicionales al archivo de configuraci&#xF3;n, diferentes a los predefinidos.
  * @param {!String} environment Nombre que identifica al ambiente de ejecuci&#xF3;n (development, test &#xF3; production).
  * @param {Object} [config] Objeto que contiene los campos de configuraci&#xF3;n. Todas las configuraciones posibles se describen en: {@link Config#constructor}.
  */
  set(environment, config = {}) {
    if (this.env == environment) {
      this._setEnviroment(config)
    }
  }

  /**
  * Carga la configuraci&#xF3;n del proyecto si es que existe (archivo &apos;.insac.js&apos;)
  * @param {Object} config Datos de configuraci&#xF3;n enviados desde el constructor.
  * @param {String} projectPath Ruta del directorio raiz del proyecto.
  */
  _loadProjectConfig(config = {}, projectPath) {
    try {
      let customConfig = require(path.resolve(projectPath, &apos;.insac.js&apos;))
      // Primero se carga la configuraci&#xF3;n del archivo .insac.js
      this._setProject(customConfig, projectPath)
    } catch(err) { } finally {
      // Despu&#xE9;s se carga la configuraci&#xF3;n que se env&#xED;a directamente desde el constructor
      this._setProject(config, projectPath)
    }
  }

  /** @ignore  */
  _setProject(config = {}, projectPath) {
    if (config.path) {
      if (config.path.public) this.path.public = path.resolve(projectPath, config.path.public)
      if (config.path.config) this.path.config = path.resolve(projectPath, config.path.config)
      if (config.path.global) this.path.global = path.resolve(projectPath, config.path.global)
      if (config.path.middlewares) this.path.middlewares = path.resolve(projectPath, config.path.middlewares)
      if (config.path.models) this.path.models = path.resolve(projectPath, config.path.models)
      if (config.path.routes) this.path.routes = path.resolve(projectPath, config.path.routes)
      if (config.path.seeders) this.path.seeders = path.resolve(projectPath, config.path.seeders)
    }
  }

  /**
  * Carga la configuraci&#xF3;n de la aplicaci&#xF3;n si es que existe (Archivo &apos;config.js&apos;)
  * @param {Object} config Datos de configuraci&#xF3;n enviados desde el constructor.
  * @param {String} configPath Ruta del directorio Config.
  */
  _loadAppConfig(config = {}, configPath) {
    try {
      // Primero carga la configuraci&#xF3;n del archivo config.js
      this._loadAppConfigFromPath(configPath)
    } catch(err) { } finally {
      // Despu&#xE9;s se carga la configuraci&#xF3;n que se env&#xED;a directamente desde el constructor
      this._setEnviroment(config)
    }
  }

  /** @ignore */
  _loadAppConfigFromPath(path) {
    if (fs.statSync(path).isDirectory()) {
      fs.readdirSync(path).forEach(file =&gt; {
        let newPath = `${path}/${file}`
        this._loadAppConfigFromPath(newPath)
      })
    } else {
      try { require(path)(this) } catch(err) { }
    }
  }

  /**
  * Carga todas las variables globales de la aplicaci&#xF3;n.
  */
  _loadAppGlobal() {
    try {
      this._loadAppGlobalFromPath(this.path.global)
    } catch(err) { }
  }

  /** @ignore */
  _loadAppGlobalFromPath(path) {
    if (fs.statSync(path).isDirectory()) {
      fs.readdirSync(path).forEach(file =&gt; {
        let newPath = `${path}/${file}`
        this._loadAppGlobalFromPath(newPath)
      })
    } else {
      require(path)
    }
  }

  /** @ignore */
  _setEnviroment(config = {}) {
    for (let prop in config) {
      if ((prop == &apos;env&apos;) || (prop == &apos;projectPath&apos;) || (prop == &apos;server&apos;) || (prop == &apos;database&apos;) || (prop == &apos;auth&apos;)) {
        if (prop == &apos;server&apos;) {
          if (config.server.all200) this.server.all200 = config.server.all200
          if (config.server.port) this.server.port = config.server.port
        }
        if (prop == &apos;database&apos;) {
          if (config.database.name) this.database.name = config.database.name
          if (config.database.username) this.database.username = config.database.username
          if (config.database.password) this.database.password = config.database.password
          if (config.database.dialect) this.database.dialect = config.database.dialect
          if (config.database.host) this.database.host = config.database.host
          if (config.database.port) this.database.port = config.database.port
        }
        if (prop == &apos;auth&apos;) {
          if (config.auth.token) {
            if (config.auth.token.key) this.auth.token.key = config.auth.token.key
            if (config.auth.token.expires) this.auth.token.expires = config.auth.token.expires
          }
        }
        continue
      }
      /**
      * Informaci&#xF3;n extra que puede adicionarse al archivo de configuraci&#xF3;n.
      * @type {Object} prop
      */
      this[prop] = config[prop]
    }
  }

  /**
  * Directorio por defecto del proyecto
  * @return {String}
  */
  static defaultProjectPath(projectPath) {
    return path.resolve(__dirname, &apos;./../../../../&apos;)
  }

  /**
  * Configuraci&#xF3;n por defecto de las carpetas del proyecto.
  * @param {String} projectPath - Directorio base (directorio raiz del proyecto).
  * @return {Object}
  */
  static defaultPath(projectPath) {
    return {
      public: path.resolve(projectPath, &apos;./public&apos;),
      config: path.resolve(projectPath, &apos;./src/config&apos;),
      global: path.resolve(projectPath, &apos;./src/global&apos;),
      middlewares: path.resolve(projectPath, &apos;./src/middlewares&apos;),
      models: path.resolve(projectPath, &apos;./src/models&apos;),
      routes: path.resolve(projectPath, &apos;./src/routes&apos;),
      seeders: path.resolve(projectPath, &apos;./src/seeders&apos;)
    }
  }

  /**
  * Configuraci&#xF3;n por defecto del servidor.
  * @return {Object}
  */
  static defaultServer() {
    return {
      port: 3200,
      all200: false
    }
  }

  /**
  * Configuraci&#xF3;n por defecto de la base de datos
  * @return {Object}
  */
  static defaultDatabase() {
    return {
      name: &apos;insac_app&apos;,
      username: &apos;postgres&apos;,
      password: &apos;postgres&apos;,
      dialect: &apos;postgres&apos;,
      host: &apos;localhost&apos;,
      port: 5432
    }
  }

  /**
  * Configuraci&#xF3;n por defecto del sistema de autenticaci&#xF3;n mediante tokens
  * @return {Object}
  */
  static defaultAuth() {
    return {
      token: {
        key: &apos;SECRET&apos;,
        expires: 86400
      }
    }
  }

}

module.exports = Config
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.1)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
