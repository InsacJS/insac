<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">lib/models/Model.js | Insac Framework</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Framework de creaci&#xF3;n de servicios web"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Insac Framework"><meta property="twitter:description" content="Framework de creaci&#xF3;n de servicios web"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/waquispe/insac"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Insac.js~Insac.html">Insac</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#datatypes">datatypes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/datatypes/DataType.js~DataType.html">DataType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/datatypes/INTEGER.js~INTEGER.html">INTEGER</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/datatypes/STRING.js~STRING.html">STRING</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#models">models</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Config.js~Config.html">Config</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Database.js~Database.html">Database</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Field.js~Field.html">Field</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Middleware.js~Middleware.html">Middleware</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Model.js~Model.html">Model</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Reference.js~Reference.html">Reference</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Response.js~Response.html">Response</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/ResponseError.js~ResponseError.html">ResponseError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Seeder.js~Seeder.html">Seeder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Server.js~Server.html">Server</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#routes">routes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/Route.js~Route.html">Route</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/RouteDelete.js~RouteDelete.html">RouteDelete</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/RouteGet.js~RouteGet.html">RouteGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/RoutePost.js~RoutePost.html">RoutePost</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/RoutePut.js~RoutePut.html">RoutePut</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#tools">tools</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/tools/DataTypes.js~DataTypes.html">DataTypes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/tools/Util.js~Util.html">Util</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/tools/Validators.js~Validators.html">Validators</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#validators">validators</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/validators/INTEGER_VALIDATOR.js~INTEGER_VALIDATOR.html">INTEGER_VALIDATOR</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/validators/STRING_VALIDATOR.js~STRING_VALIDATOR.html">STRING_VALIDATOR</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/validators/Validator.js~Validator.html">Validator</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/models/Model.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;
/** @ignore */ const Field = require(&apos;./Field&apos;)
/** @ignore */ const Reference = require(&apos;./Reference&apos;)

/**
* Describe un modelo que representa a una tabla de la base de datos, definiendo sus caracteristicas y comportamiento.
*/
class Model {

  /**
  * Crea una instancia de la clase Model.
  * @param {!String} name - Nombre del modelo.
  * @param {Object} [model={}] - Datos del modelo. Por defecto crea un modelo con el campo ID.
  * @param {Object} [model.fields] - Campos del modelo. Objeto de contiene pares clave valor, cada par representa un campo, el valor de una clave puede ser de tipo Field o un Objeto. Por defecto se adiciona el campo ID si no se lo hubiera declarado
  * @param {Object} [model.options] - Opciones del modelo.
  * @param {String} [model.options.singular] - Nombre en singular del modelo. Por defecto es el mismo nombre del modelo.
  * @param {String} [model.options.plural] - Nombre en plural del modelo. Por defecto es el mismo nombre del modelo seguido de una s.
  * @param {String[]} [model.options.uniqueKeys=[]] - Contiene los nombres de los campos que deben ser &#xFA;nicos.
  * @param {Boolean} [model.options.timestamps=false] - Indica si se adicionar&#xE1;n los campos createdAt y updatedAt al modelo.
  * @param {String} [model.options.createdAt=&apos;_fecha_creacion&apos;] - Nombre del campo createdAt.
  * @param {String} [model.options.createdAt=&apos;_fecha_modificacion&apos;] - Nombre del campo updatedAt.
  * @param {Object[]} [model.options.associations=[]] - Listado de nombres de todos los modelos que hacen referencia a este modelo. Este valor se asigna autom&#xE1;ticamente cuando otro modelo lo referencia.
  * @param {String} [model.options.associations[].model] - Nombre del modelo que lo referencia.
  * @param {String} [model.options.associations[].as] - Nombre con el que se identificar&#xE1; el modelo que establece la referencia.
  */
  constructor(name, model = {}) {
    /**
    * Nombre del modelo.
    * @type {String}
    */
    this.name = name

    /**
    * Objecto que contiene los campos del modelo
    * @type {Object}
    */
    this.fields = {}
    // Por defecto se adiciona el campo ID
    if (!model.fields) model.fields = {}
    if (!model.fields.id) this.fields.id = Field.ID()
    for (let fieldName in model.fields) {
      let field = model.fields[fieldName]
      this.fields[fieldName] = (field instanceof Field) ? field : new Field(field)
      // Se actualiza el nombre del campo
      this.fields[fieldName].name = fieldName
    }

    /**
    * Objeto que contiene algunas opciones extras del modelo
    * @type {Object} [options]
    * @property {String} [options.singular] - Nombre en singular del modelo.
    * @property {String} [options.plural] - Nombre en plural del modelo.
    * @property {String[]} [options.uniqueKeys=[]] - Nombres de los campos que deben ser &#xFA;nicos
    * @property {Boolean} [options.timestamps=false] - Habilita los campos createdAt y updatedAt.
    * @property {String} [options.createdAt=&apos;_fecha_creacion&apos;] - Nombre del campo createdAt.
    * @property {String} [options.updatedAt=&apos;_fecha_modificacion&apos;] - Nombre del campo updatedAt.
    * @property {String} [options.associations=[]] - Listado de nombres de todos los modelos que hacen referencia a este modelo.
    */
    this.options = {
      singular: this.name,
      plural: `${this.name}s`,
      uniqueKeys: [],
      timestamps: false,
      createdAt: &apos;_fecha_creacion&apos;,
      updatedAt: &apos;_fecha_modificacion&apos;,
      associations: []
    }
    if (model.options) {
      if (model.options.singular) this.options.singular = model.options.singular
      if (model.options.plural) this.options.plural = model.options.plural
      if (model.options.uniqueKeys) this.options.uniqueKeys = model.options.uniqueKeys
      if (typeof model.options.timestamps != &apos;undefined&apos;) this.options.timestamps = model.options.timestamps
      if (model.options.createdAt) this.options.createdAt = model.options.createdAt
      if (model.options.updatedAt) this.options.updatedAt = model.options.updatedAt
    }
  }

  /**
  * Devuelve un objeto para crear modelos sequelize
  * @return {Object} Contiene los campos name, attributes y options
  */
  sequelize() {
    let define = { name:this.name, attributes:{}, options:{} }
    // Atributos
    for (let i in this.fields) {
      define.attributes[this.fields[i].name] = this.fields[i].sequelize()
    }
    // Opciones
    define.options[&apos;singular&apos;] = this.options.singular
    define.options[&apos;plural&apos;] = this.options.plural
    define.options[&apos;timestamps&apos;] = this.options.timestamps
    define.options[&apos;uniqueKeys&apos;] = this._sequelizeOptionsUnique()
    define.options[&apos;createdAt&apos;] = this.options.createdAt
    define.options[&apos;updatedAt&apos;] = this.options.updatedAt
    // Opci&#xF3;n por defecto
    define.options[&apos;freezeTableName&apos;] = true
    return define
  }

  /**
  * Devuelve la opci&#xF3;n uniqueKeys para un modelo sequelize (SequelizeModel).
  * @return {Object}
  */
  _sequelizeOptionsUnique() {
    let sequelizeOptionsUnique = []
    for (let i in this.options.uniqueKeys) {
      let uniqueKey = this.options.uniqueKeys[i]
      if (typeof uniqueKey == &apos;string&apos;) sequelizeOptionsUnique.push({fields:[uniqueKey]})
      if (Array.isArray(uniqueKey)) sequelizeOptionsUnique.push({fields:uniqueKey})
    }
    return sequelizeOptionsUnique
  }

}

module.exports = Model
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.1)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
