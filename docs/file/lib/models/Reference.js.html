<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">lib/models/Reference.js | Insac Framework</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Framework de creaci&#xF3;n de servicios web"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Insac Framework"><meta property="twitter:description" content="Framework de creaci&#xF3;n de servicios web"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/waquispe/insac"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Insac.js~Insac.html">Insac</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#datatypes">datatypes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/datatypes/DataType.js~DataType.html">DataType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/datatypes/INTEGER.js~INTEGER.html">INTEGER</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/datatypes/STRING.js~STRING.html">STRING</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#models">models</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Config.js~Config.html">Config</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Database.js~Database.html">Database</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Field.js~Field.html">Field</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Middleware.js~Middleware.html">Middleware</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Model.js~Model.html">Model</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Reference.js~Reference.html">Reference</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Response.js~Response.html">Response</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/ResponseError.js~ResponseError.html">ResponseError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Seeder.js~Seeder.html">Seeder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/models/Server.js~Server.html">Server</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#routes">routes</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/Route.js~Route.html">Route</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/RouteDelete.js~RouteDelete.html">RouteDelete</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/RouteGet.js~RouteGet.html">RouteGet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/RoutePost.js~RoutePost.html">RoutePost</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/routes/RoutePut.js~RoutePut.html">RoutePut</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#tools">tools</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/tools/DataTypes.js~DataTypes.html">DataTypes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/tools/Util.js~Util.html">Util</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/tools/Validators.js~Validators.html">Validators</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#validators">validators</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/validators/INTEGER_VALIDATOR.js~INTEGER_VALIDATOR.html">INTEGER_VALIDATOR</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/validators/STRING_VALIDATOR.js~STRING_VALIDATOR.html">STRING_VALIDATOR</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/validators/Validator.js~Validator.html">Validator</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/models/Reference.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;
/** @ignore */ const Field = require(&apos;./Field&apos;)

/** @ignore */ const ONE_TO_ONE = &apos;1:1&apos;
/** @ignore */ const ONE_TO_MANY = &apos;1:N&apos;

/**
* Describe un campo que hace referencia a otra tabla
* @extends {Field}
*/
class Reference extends Field {

  /**
  * Crea una instancia de la clase Reference.
  * @param {String} [name=&apos;field&apos;] Nombre del campo.
  * @param {Object} [field={}] Caracteristicas del campo.
  * @param {DataType} [field.type=STRING] Tipo de dato del campo.
  * @param {Validator} [field.validator] Objeto que se encarga de la validaci&#xF3;n del campo. Por defecto se asigna un validador de acuerdo al tipo de dato
  * @param {String} [field.description=undefined] Descripci&#xF3;n del campo.
  * @param {Boolean} [field.allowNull=true] Indica si el campo acepta valores nulos.
  * @param {Boolean} [field.unique=false] Indica si en todos los registros debe haber solamente uno con este valor.
  * @param {Boolean} [field.primaryKey=false] Indica si el campo es una llave primaria.
  * @param {Boolean} [field.autoIncrement=false] Indica si es un valor autoincrementable.
  * @param {String|Number|Boolean} [field.defaultValue=undefined] Valor por defecto del campo.
  * @param {!Object} reference Datos de la referencia.
  * @param {!String} reference.model Nombre del modelo al que se hace referencia.
  * @param {String} [reference.as] Nombre con el que se identificar&#xE1; el modelo. Por defecto, si el tipo de relaci&#xF3;n es ONE_TO_ONE, as = model, y si es ONE_TO_MANY, as = model + s.
  * @param {String} [reference.type=&apos;1:1&apos;] Tipo de referencia. Valores posibles: &apos;1:1&apos; &#xF3; &apos;1:N&apos;
  * @param {String} [reference.key=&apos;id&apos;] Nombre del campo ID del modelo de referencia
  */
  constructor(name, field, reference) {
    super(name, field)
    let model = reference.model
    let type = reference.type || ONE_TO_ONE
    let as = reference.as || ((type == ONE_TO_ONE) ? model : `${model}s`)
    let key = reference.key || &apos;id&apos;

    /**
    * Datos de la referencia.
    * @type {Object}
    * @property {!String} reference.model - Nombre del modelo al que se hace referencia.
    * @property {String} [reference.as] - Nombre con el que se identificar&#xE1; al modelo.
    * @property {String} [reference.type=&apos;1:1&apos;] - Tipo de referencia.
    */
    this.reference = {model:model, as:as, type:type, key:key}
  }

  /**
  * Devuelve un objeto para el campo de un modelo sequelize (SequelizeModel)
  * @return {Object} Campo de un modelo sequelize (SequelizeModel).
  * @override
  */
  sequelize() {
    let attribute = super.sequelize()
    attribute.references = {
      model: this.reference.model,
      as: this.reference.as,
      key: this.reference.key
    }
    return attribute
  }

  /**
  * Devuelve un campo que hace referncia a otra tabla con una relaci&#xF3;n de uno a uno.
  * @param {!Model} model - Modelo al que se hace referencia.
  * @param {Object} [field={}] Caracteristicas del campo.
  * @param {Boolean} [field.allowNull=true] Indica si el campo acepta valores nulos.
  * @param {Boolean} [field.unique=false] Indica si en todos los registros debe haber solamente uno con este valor.
  * @param {Boolean} [field.primaryKey=false] Indica si el campo es una llave primaria.
  * @param {Boolean} [field.autoIncrement=false] Indica si es un valor autoincrementable.
  * @param {String|Number|Boolean} [field.defaultValue=undefined] Valor por defecto del campo.
  * @return {Reference} Instancia de la clase Reference
  */
  static ONE_TO_ONE(model, field) {
    let key = field.key ? field.key : &apos;id&apos;
    field.type = model.fields[key].type
    field.validator = model.fields[key].validator
    field.description = `${model.fields[key].description} del registro &apos;${model.name}&apos;`
    return new Reference(&apos;id_field&apos;, field, {model:model.name, as:field.as, type:ONE_TO_ONE, key:key})
  }

  /**
  * Devuelve un campo que hace referncia a otra tabla con una relaci&#xF3;n de uno a muchos.
  * @param {!Model} model - Modelo al que se hace referencia.
  * @param {Object} [field={}] Caracteristicas del campo.
  * @param {Boolean} [field.allowNull=true] Indica si el campo acepta valores nulos.
  * @param {Boolean} [field.unique=false] Indica si en todos los registros debe haber solamente uno con este valor.
  * @param {Boolean} [field.primaryKey=false] Indica si el campo es una llave primaria.
  * @param {Boolean} [field.autoIncrement=false] Indica si es un valor autoincrementable.
  * @param {String|Number|Boolean} [field.defaultValue=undefined] Valor por defecto del campo.
  * @return {Reference} Instancia de la clase Reference
  */
  static ONE_TO_MANY(model, field) {
    let key = field.key ? field.key : &apos;id&apos;
    field.type = model.fields[key].type
    field.validator = model.fields[key].validator
    field.description = `${model.fields[key].description} del registro &apos;${model.name}&apos;`
    return new Reference(&apos;id_field&apos;, field, {model:model.name, as:field.as, type:ONE_TO_MANY, key:key})
  }

}

module.exports = Reference
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.1)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
